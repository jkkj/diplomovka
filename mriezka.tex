\chapter{Konštrukcia mriežky}
\begin{defin}
Mriežka veľkosti $ n \times m$ je graf $P_{n} \times P_{m}$
\end{defin}
\begin{defin}
Cyklická mriežka veľkosti $n \times m$ je graf $C_{n} \times C_{m}$.
\end{defin}

V tejto kapitole sa budeme zaoberať mriežkou a cyklickou mriežkou. Na to, aby sme sa v
týchto dvoch grafoch dokázali dobre orientovať, zavedieme pojem dimenzie a
jej súradnice. Pričom využujeme, že oba grafy sú produktmi kartézskeho
súčinu. Výsledky v tejto kapitole môžu byť užitočné pri hľadaní konštrukcií
grafov, ktoré sú výsledkom kartézskyh súčinov zložitejších grafov. Cesta a
cyklus totiž patria medzi najjednoduchšie podgrafy.

Na začiatok potrebujeme niekoľko označení, aby sme sa dokázali v mrižke a
cyklickej mriežke dobre orientovať.

\begin{ozn}
Pojem dimenzie v produkte kartézskeho súčinu $G$, grafov $U$ a $V$ 
zavedieme prirodzene vzhľadom
na označenie vrcholov produktu ako usporiadanej dvojice $(u,v)$, kde $u \in
U$ a $v \in V$. i-tou dimenziou vrchola produktu tohto súčinu bude i-ty člen
tejto dvojice. Súradnicou v dimenzii i je prvok na i-tej pozícii v
usporiadanej dvojici. Pre zjednodušenie označíme vrcholy pôvodných grafov
prirodzenými číslami od 1 po m respektíve od 1 po n. Vrcholy produktu
kartézskeho súčinu týchto dvoch grafov budú pre dosť veľké m,n napríklad
$(2,4)$, $(5,17)$, $(9,1)$, atď.
\end{ozn}

\begin{pozn}
Pri mriežke a cyklickej mriežke budeme číslovať vrcholy pôvodných grafov
tak, aby sa označenia susedných vrcholov líšili o jedna, v prípade cyklickej
mriežky budú v pôvodných grafoch - cykloch spojené aj vrcholy 1 a n,
repektíve 1 a m.
\end{pozn}

Nasledujúcu lemu budeme používať neskôr. Hovorí o tom, že ak mriežka má oba
rozmery väčšie ako tri, agent pri konštrukcii každej hrany vykoná najmenej
tri pohyby. Cyklická mriežka s rozmerom dva nemôže existovať, lebo by
obsahovala násobné hrany. Pokiaľ má cyklická mriežka niektorý rozmer tri,
tak vie agent niektoré jej hrany skonštruovať na dva kroky. Hrany, 
ktoré pri tom
prejde však musia byť buď kostrové alebo ich skonštruuje na tri kroky. Toto
je veľmi špeciálny prípad.

\begin{lem}
Pri konštrukcii portovej hrany v mriežke aj v cyklickej mriežke, ktorá
nemá žiaden rozmer menší ako štyri, 
urobí agent medzi otvorením prvého a druhého
portu najmenej tri kroky.
\end{lem}
\begin{proof}
Najmenší cyklus v oboch grafoch má dĺžku štyri. 
Teda medzi otvorením dvoch portov
hrany vykoná agent najmenej tri pohyby po hranách. Buď prejde po už
existujúcich alebo vytvorí nové operáciou NH.
\end{proof}

\section{Jedna značka pre porty}

Z výsledkov pre konštrukciu cyklickej mriežky v prípade, keď má agent k
dispozícii len jednu značku pre port, je najdôležitejšie zistenie, že pri
konštrukcii musí agent pri niektorej z portových hrán od otvorenia prvého po
otvorenie jej druhého portu prejsť po všetkých súradniciach okrem tej, v
ktorej táto hrana vedie. Toto platí pre obe dimenzie.

Pre konštrukciu mriežky s jednou značkou pre porty sme dokázali, že sa dá
skonštruovať na tri kroky pre každý port plus agent vykonal navyše $m-1$
krokov, kde m je menší z rozmerov. Vyslovili sme hypotézu, že na menej
krokov to nie je možné. Aj keď sa nám ju nepodarilo uspokojivo dokázať,
urobili sme viacero zaujímavých pozorovaní.

Teraz nasledujú prípravné lemy k týmto výsledkom. Pripomenieme, že pojem
tvoriaci cyklus portovej hrany označujenajmenší cyklus obsahujúci danú hranu
vybraný zo sledu, ktorý agent prešiel medzi otvorením jej prvého a druhého
portu.

Pri dokazovaní výsledku o cyklickej mriežke využijeme fakt, že nahradením
hrany v tvoriacom cykle s párnym počtom výskytov ostatných súradníc sa nemení 
ich parita. Pokiaľ sa teda zmení, musela byť nahrádzaná hrana s nepárnym
počtom výskytov ostatných súradníc v tvoriacom cykle a tento nepárny výskyt
musel agent $"$odšľapať$"$.

Uvažovať o konštrukcii cyklickej mriežky v prípade, že agent má k dispozícii
len jednu značku preporty má viacero dôvodov. Jedným môže byť konštrukcia
kartézskeho súčinu zložitejších grafov, ktorého je nejaká cyklická mriežka
podgrafom za situácie, že agent má veľmi obmedzený počet značiek pre porty.

Nasledujúcich niekoľko lem platí o konštrukcii grafov naším modelom
všeobecne, ale ich potreba sa obzvlášť prejavila pri hľadaní efektívnej
konštrukcie mriežky.

\begin{lem}
Kostrové hrana je staršia, vznikla skôr, ako všetky portové hrany incidentné
s jej mladším koncovým vrcholom.
\end{lem}
\begin{proof}
Aby agent mohol otvoriť vo vrchole port, musel už tento vrchol existovať.
Jediná operácia ktorou mohol vrchol vzniknúť je operácia NH. Mladší vrchol
vznikol spolu s kostrovou hranou a preto doň predtým nemohli viesť žiadne
hrany.
\end{proof}


\begin{lem}
Tvoriaci cyklus hrany $h$ obsahuje len hrany staršie ako $h$.
\end{lem}
\begin{proof}
Tvoriaci cyklus obsahuje hrany, po ktorých agent prešiel, keď konštuoval
hranu $h$. Museli teda v čase po prechode agenta už existovať a sú preto 
staršie ako hrana $h$, ktorú agent vytvoril až potom, ako po týchto hranách
prešiel.
\end{proof}

Nasledujúce lemy sme použili najmä pri dôkaze výsledku o cyklickej mriežke,
kde sme dokázali, že pri každej konšrukcii je pre každú dimenziu nejaká
hrana, pri konštrukcii ktorej agent prejde po všetkých súradniciach tejto
dimenzie - okrem súradnice tejto hrany.

Tiež nasleduje zavedenie niekoľkých ďalších použitých pojmov.

\begin{lem}
\label{cyklus}
Každý tvoriaci cyklus je možné nahradiť tvoriacim cyklom, ktorý obsahuje len
hrany kostry a príslušnú portovú hranu.
\end{lem}
\begin{proof}
Majme tvoriaci cyklus hrany $h$. Každú portovú hranu, okrem $h$  v ňom nahradíme 
jej tvoriacim
cyklom, až kým nemáme uzavretý sled na kostrových hranách a hrane $h$. Z
neho vieme vybrať tvoriaci cyklus hrany $h$.
\end{proof}


Teraz si zavedieme pojem dimenzie v kartézskom súčine, čo budeme potrebovať
pri mriežke aj cyklickej mriežke.

\begin{ozn}
Graf prislúchajúci dimenzii d grafu G je d-ty činiteľ kartézskeho súčinu, 
ktorého je G produktom.
\end{ozn}

\begin{ozn}
Hrana v mriežke a cyklickej mriežke vedie medzi dvomi vrcholmi, 
ktoré sa líšia v práve jednej dimenzii a v tejto majú súradnice vrcholov,
ktoré spolu susedia v grafe, ktorý prislúcha danej dimenzii. Teda ak je to
prvá dimenzia jedná sa o prvý člen kartézskeho súčinu a ak je to druhá
dimenzia o druhý. Súradnica hrany budeme volať súradnicu k, ak k je
najvyššia súradnica v danej dimenzii a hrana spája vrcholy s najnižšou a
najvyššou súradnicou dimenzie, alebo nižšia zo súradníc v ktorých sa líšia
vrcholy spojené touto hranou.

Hranu so súradnocou k budeme volať niekedy hrana v súradnici k. Rovnako
budeme používať pojem dimenzia hrany a hrana dimenzie.
\end{ozn}
\begin{ozn}
Prechodom po súradnici budeme volať prechod agenta po hrane danej súradnice.
\end{ozn}

\begin{ozn}
Susedná súradnica k súradnici k v dimenzii d, je každá súradnica vrchola,
ktorý
spája nejaká hrana s vrcholom so súradnicou k 
v grafe prislúchajúcom dimenzii d.
\end{ozn}

Pre každú súradnicu vieme zistiť koľkokrát prešiel agent po nejakej hrane v
tejto súradnici. Zaujíma nás špeciálne parita tohto počtu a pre každú
súradnicu zvlášť.

\begin{lem}
Portová hrana v súradnici k v cyklickej mriežke má v tvoriacom cykle 
odlišnú paritu počtu prechodov po súradnici k ako majú počty prechodov 
po ostatných súradniciach
V ostatnej dimenzii majú všetky počty prechodov po jednotlivých súradniciach
rovnakú paritu.
\end{lem}
\begin{proof}
Aby otvoril druhý port hrany, agent musí svoju pozíciu zmeniť tak, 
aby sa nachádzal na susednej súradnici v diemnzii v ktorej sa líši s
vrcholom s otvoreným prvým portom v dimenzii kam má viesť konštruovaná hrana.
Keď rozdelíme pohyby agenta medi jednotlivé dimenzie, môžeme jeho pohyb
premietnuť do grafov týchto dimenzií. Budeme teda sledovať len to ako sa
mení tá, ktorá súradnica agenta pri jeho pohybe po tvoriacom cykle.
Keďže vrcholy v ktorých otvára porty sa líšia iba v dimenzii konštruovanej
hrany, v jednej dimenzii majú rovnakú súradnicu. Do grafu tejto dimenzie sa
pohyb agenta premietne ako uzavretý sled, kde skončí vo vrchole, v ktorom
začal.
Poďme spočítať paritu prechodov po jednotlivých súradniciach v slede do
ktorého sa v tomto grafe premietne prechod agenta.  Vezmime tie výskyty toho
istého vrcholu, medzi ktorými sú výskyty len iných vrcholov a to každého 
najviac raz. Takže aké pohyby mohol urobiť agent medzi dvomi najbližšími
návštevami nejakého vrcholu? Mohol sa vrátiť zo susedného vrchola - zo
vzdialenejšieho už nie, lebo susedný, cez ktorý by išiel by sa vyskytol na
tomto slede viackrát ako raz. 
Alebo mohol agent prejsť po ceste, kde cieľom
aj východiskom je tento vrchol. Takáto cesta je buď prázdna alebo obsahuje
všetky iné vrcholy y je to vlastne prejdenie cyklu dookola.
V prvom prípade sa parita prechodov po súradniciach zachová, lebo agent
prešiel tam a spať po rovnakej súradnici. V druhom prípade sa zmení parita
prechodov pre všetky súradnoce. V oboch prípadoch sa teda zachová rovnosť
parít prechodov jednotlivých súradníc, ak platila aj predtým. 
Vieme teda, že medzi dvomi najbližšími výskytmi vrchola sa nič nepokazí. Na
začiatku je počet prechodov pre každú súradnicu rovnaký - nulový a teda majú
rovnakú paritu.Pri ďalšom počítaní môžeme teda tieto výskyty preskočiť -
skontrahovať. Na takto upravenom slede postup opakujeme, až kým nemáme každý
vrchol najviac raz okrem koncového a začiatočného, čo je ten istý. Preň
platia rovnaké pravidlá a teda pre túto dimenziu je veta dokázaná.

V dimenzii konštruovanej hrany sa bude pri otváraní druhého portu nachádzať
vo vrchole susednej súradnice k súradnici vrchola s prvým portom.
Ak pridáme do sledu aj konštruovanú portovú hranu, dostaneme uzavretý sled, pre ktorý
platí predošlý dôkaz. Z toho je jasné, že iba prechody po konštruovanej
hrane majú odlišnú paritu počtu svojich výskytov.
\end{proof}

Dokázali sme lemu o rozdielnosti parít, ktorú použijeme v nasledujúcej vete.
Užitočný nám ďalej je fakt, že ak je parita prechodov po nejakej súradnici
nepárna, agent po nej musel aspoň raz prejsť. Podarilo sa nám dokázať, že
pri konštrukcii niektorej hrany cyklickej mriežky musel agent prejsť medzi
otvorením jej prvého a druhého portu po každej inej súradnici nepárny počet
krát. Teda musel prejsť aspoň toľko krokov, koľko je zvyšných súradníc, čo
je o jedna menej ako príslušný rozmer mriežky.

Tento výsledok umožňuje posun dolného odhadu počtu krokov konštrukcie
cyklickej mriežky. Ukazuje, že nie je možné každú jej hranu skonštruovať na
tri kroky.

\begin{veta}
Pri ľubovoľnej konštrukcii cyklickej mriežky G rozmerov $n \times m$ 
s jednou značkou
pre porty, existuje aspoň jedna hrana pri konštrukcii ktorej agent vykoná 
aspoň $n - 1$ krokov v prvej dimenzii
a súčasne aspoň jedna portová hrana,
 pri konštrukcii ktorej agent vykoná aspoň $m - 1$ krokov v druhej dimenzii,
môže ísť o tú istú hranu.
\end{veta}
\begin{proof}
Ako sme už povedali kostrové hrany sú hrany, ktoré vznikli operáciou NH a
tieto hrany tvoria kostru grafu; ako bolo spomenuté grafom nazývame každý
medziprodukt konštrukcie počnúc počiatočným vrcholom až po konečný
skonštruovaný graf.

Každej konštrukcii grafu G zodpovedá nejaká kostra z kostrových hrán. Počet
krokov, ktoré agent vykonal pri konštrukcii hrany h je súčet počtu krokov do
vrchola v, v ktorom otvoril prvý port hrany a počet krokov z vrchola v do
vrchola u, v ktorom otvoril druhý port hrany, 
tento sled z u do v tvoria s portovou
hranou uzavretý sled. Tento sled obsahuje tvoriaci cyklus danej portovej
hrany.

Majme ľubovoľnú konštrukciu cyklickej mriežky $G$ a k nej zodpovedajúcu
kostru. Ukážeme, že pre ňu platí tvrdenie vety.
Táto kostra určuje aj to, ktoré hrany grafu sú portové - tie, ktoré nie sú v
kostre. Pripomeňme si, že kostra zodpovedajúca konštrukcii je kostra tvorená
práve všetkými hranami, ktoré vznikli operáciami NH.

Ukážeme, že existuje aspoň jedna hrana, ktorej tvorivý cyklus bez tejto
hrany obsahuje jej
súradnicu párny počet krát - teda ostatné súradnice v tejto dimenzii nepárny
počet krát. Rovnako to dokážeme pre obe dimenzie. Možné sú dva prípdy, buď
ide o dve rôzne hrany, alebo o jedinú hranu.
Keďže agent musel prejsť do susednej súradnice vrchola s prvým portom hrany
a nemohol tak urobiť v jej súradnici, musel prejsť po všetkých ostatných
súradniciach a teda vykonať aspoň n-1 respektíve m-1 krokov v prípade, že
platí alternatíva s dvomi rôznymi hranami. Alebo n+m - 1 ak platí
alternatíva s jedinou hranou. 

Pozrieme sa na ľubovoľnú kostru. V tejto kostre sa nachádzajú všetky vrcholy
grafu. Aký je tvorivý cyklus jednotlivých portových hrán. V tvorivom cykle
portovej hrany $h$
je možné nahradiť niektorú portovú hranu jej tvorivou cestou. Takýmto
nahrádzaním postupne vieme nahradiť všetky portové hrany. Keď z výsledného
sledu vyberieme konštrukčnú cestu, tento už obsahuje iba kostrové hrany.
Pozrime sa na paritu počtu prechodov jednotlivých súradníc v tejto ceste.
Tvrdíme, že ak sme nenahrádzali hranu, ktorej tvorivá cesta obsahovala
súradnicu tejto hrany párny počet krát, výsledná tvorivá cesta na
kostrových hranách bude obsahovať nepárny počet prechodov po súradnici 
hrany $h$.
Toto je zrejmé. Ak výskyt hrany nahradíme cestou, kde sa táto hrana nachádza
nepárny počet krát, počet prechodov po súradnici hrany sa nezmení. Toto
zároveň implikuje, že prechody po ostatných súradniciach sa na tejto ceste
nachádzajú párny počet krát zvlášť pre každú súradnicu. Teda nezmení sa ani
parita prechodov po ostatných súradniciach.
Čo sa týka parít počtov prechodov v ostatnej dimenzii, tak tu platí to isté,
ak nahrádzame hranu jej tvorivou cestou, kde je počet prechodov po súradnici
tejto hrany párny, tak aj vo výslednom slede je počet prechodov párny pre každú
súradnicu tejto dimenzie.

Keďže výsledný sled, krorý vznikol nahradením tvorivej cesty portovej hrany
$h$ vedie len po kostrových hranách a na tých neexistuje cyklus, tvorivá
cesta hrany $h$ vybraná z tohto sledu zachováva paritu prechodov po
jednotlivých súradniciach takú, aká je v tomto slede.
Kostra je totiž strom a ak sa na slede vyskytne dvakrát ten istý vrchol, tak
medzi dvomi jeho susednými výskytmi je párny výskyt prechodov po
jednotlivých súradniciach a teda ho môžeme zo sledu vybrať - skontrahovať na
jeden výskyt tohoto vrchola. Jediná šanca ako pri pohybe po strome navštíviť
opätovne niektorý vrchol je vrátiť sa doň.

Na kostre existuje pre každú portovú hranu jediná tvorivá cesta, inak by na
nej bol cyklus, čo je spor.
Vezmime si teraz dimenziu $d$ a vrcholy, ktoré majú v ostatnej dimenzii
rovnakú súradnicu, označme ju $k$. Indukovaný podgraf na týchto vrcholoch je
cyklus. Niektoré jeho hrany sú kostrové, ostatné sú portové. Pokiaľ má každá
portová hrana tvorivú cestu na kostre s nepárnym počtom prechodov po jej
súradnici, existuje na kostre cyklus, čo je spor.
Tento cyklus získame z uzavretého sledu vytvoreného z indukovaného grafu
týchto vrcholov, kde portové hrany nahradíme ich tvorivými cestami na
kostre. Vo výslednom slede sa každá hrana bude nachádzať nepárny počet krát
a teda v ňom existuje cyklus, ktorý minimálne raz prejde po každej súradnici
danej dimenzie.

Z toho vyplýva, že niektorá nahrádzaná hrana mala tvorivú cestu s párnym
počtom prechodov po jej súradnici.
Teda pre každú dimenziu existuje hrana, ktorej tvorivá cesta obsahuje
nepárne počty prechodov po súradniciach tejto dimenzie. A agent pri jej
konštrukcii musí vykonať aspoň $n - 1$ krokov pre prvú dimenziu a $m - 1$
iných  krokov pre druhú dimenziu.
\end{proof}

\subsection{Úvahy o konštrukcii mriežky s jednou značkou pre porty}
Nasledovná veta dokazuje hornú hranicu pre počet krokov potrebných na
konštrukciu mriežky s použitím jedinej zančky pre porty.

\begin{veta}
Mriežku $m \times n$ je možné s použitím jedinej značky pre port zostrojiť
pomocou $3m(n - 1) + m - 1$ pohybov, kde $m <= n$.
\end{veta}
\begin{proof}
Agent vykonáva: OP,NH,NH,NH,OP,(n-2)krát (OP,S1,NH,NH,OP),S1,NH,HN,OP čím
vytvorí prvý riadok mriežky. Následne vykoná
(m-1)krát (NH,OP,S1,S2,NH,OP,(n-1)krát (OP,S1,S2,NH,OP))
\end{proof}


Domnievame sa, že ide o optimum. Teda že neexistuje konštrukcia, pri ktorej
agent používa jedinú znakču pre porty a vykoná menej krokov. 



\begin{ozn}
Okraje mriežky sú vrcholy, ktoré majú jednu súradnicu buď minimálnu alebo
maximálnu. Rohy mriežky sú vrcholy, ktoré majú maximálne alebo minimálne obe
svoje súradnice.
Rohy mriežky majú stupeň dva a vrcholy na okraji, ktoré nie sú rohmi, majú
stupeň tri.
Zvyšné vrcholy majú stupeň štyri a voláme ich vnútorné
\end{ozn}

Keď prvý raz príde agent do vrchola, tak hrana po ktorej prišiel musí byť
kostrová.
Každé prerušenie ťahu tvoreného portovými hranami, znamená, že agent okrem
krokov medzi otvorením prvého a druhého portu niektorej portovej hrany,
musel vykonať aspoň jeden krok navyše, keď nebol otvorený žiadny port. 
Počet krokov, ktoré prešiel medzi konštrukciami dvoch hrán, nazvime 
cena prerušenia. Budeme za ňu počítať aj všetky kroky, ktoré vykoná medzi
otvorením dvoch portov rovnakej hrany, ktoré presahujú počet tri kroky na
portovú hranu. Toto nám umožní dať prednosť portovej hrane, konštruovanej na
tri s následným jedným krokom pre otvorením portu nasledujúcej hrany, pred
portovou hranou konštruovanou na päť krokov medzi konštrukciou jej dvoch
portov.

Čím je menšia suma cien všetkých prerušení, na tým menej krokov agent
skonštruoval mriežku.
Vieme, že na každú portovú hranu musí agent vykonať aspoň tri kroky, tiež
sme dokázali horný odhad potrebných krokov.

Prerušenie určite vznikne vo vrcholoch, ktoré majú nepárny počet portových
hrán. Teda všetky vnútorné vrcholy, ktoré sú listami kostry tvoria
prerušenia.

Pokiaľ agent skonštruoval hranu na tri kroky medzi otvorením jej portov,
potom do vrchola s druhým portom príde agent po inej dimenzii, ako je tá,
v ktorej vedie portová hrana. Ak agent pri konštruovaní portových hrán príde
do okrajového vrchola má dve možnosti: buď preruší konštruovanie portových
hrán alebo bude pokračovať po okraji. Každý súvislý ťah na okraji teda
vytvára prerušenie a stojí aspoň jeden krok navyše.

Keďže vnútorné vrcholy sú stupňa štyri, ťah porotvých hrán sa nemôže v
žiadnom vrchole pretínať, pretože každý vrchol má aspoň jednu hranu kostrovú.
Taktiež v rohu je buď porotvý ťah prerušený, alebo doň porotvá hrana
nevedie, v tom prípade však vedie do aspoň jedného s ním susedného vrchola a
teda na okraj.

Poďme sa teraz pozrieť na okraje. Vrchol na okraji má stupeň tri, z čoho jedna
hrana je nutne kostra. má teda tri možnosti: buď cez neho ťah porotvých hrán
prechádza, porotvý ťah v ňom má koniec, portový ťah doň nevedie - má všetky
tri incidentné hrany kostrové.

Pokiaľ sa nám podarí dokázať, že na veľa okrajových vrcholov pripadá
prerušenie, dostaneme dolnú hranicu. Teda nemusí byť nutne v nich, ale že 
každému z nich viem priradiť iné. Aby sme dokázali, že nami predstavená
horná hranica je aj dolnou, potrebujeme zarátať prerušenia aspoň $2m - 2$
vrcholom, kde $m$ je menší z rozmerov.

Portový ťah keď už vedie po okraji, tak z neho môže odísť len ak
$"$zaplatí$"$ aspoň dva kroky navyše. Na tri kroky totiž môže pokračovať len
po okraji. Teda každému ťahu idúcemu po okraji môžeme zarátať jedno aspoň
prerušenie.

\begin{ozn}
Úsekom vrcholov ozančujeme množinu vrcholov, ktoré majú jednu dimenziu
rovnakú a tvoria ťah.

Úroveň je množina vrcholov s ronakou súradnicou v niektorej dimenzii.
\end{ozn}

Ak agent prišiel do vrchola na okraji, cez ktorý prechádza ťah, a neotvoril
v ňom port, tak urobil dva kroky navyše, môžeme ich teda vynechať. Teda vrchol
na okraji, cez ktorý prechádza ťah, bol skonštruovaný aj so svojou kostrovou 
hranou tesne pred otvorením portov pre ťahy v ňom. Z toho vyplýva, že
vnútorný vrchol, s ktorým susedí, mal predtým stupeň tri alebo v ňom bolo
prerušenie. Toto platí o všetkých vnútorných vrcholoch susediacich s ťahom
na okraji; rátame susedov tých okrajových vrcholov, kde obe portové hrany
idú po okraji. Teda máme úsek vnútorných vrcholov, ktoré boli stupňa tri
alebo v nich je prerušenie.


Ak tieto vrcholy neexistovali pred konštrukciou
ťahu po okraji, tak teraz sú stupňa tri a majú tri kostrové hrany. Teda
štvrtá je buď kostrová alebo je v nich prerušenie.
Všetky vrcholy, ktoré už existujú sú v kostre, lebo vznikli operáciou NH a
touto operáciou sa môže agent dostať do vrchola raz. Ak teda existuje v
grafe úsek
vrcholov, ktoré sú stupňa tri potom do neho budú viesť kostrové hrany alebo
portové. Každá porotvá je jedno prerušenie, pretože tieto vrcholy už sú
stupňa tri. kostrové hrany môžu viesť iba do vrcholov, kotré ešte
neexistujú.

Z úseku ešte neskonštruovaných vrcholov, ktorý susedí s úsekom vrcholov so
stupňom tri v grafe, môže do tohto úseku viesť kostrová hrana alebo porotvá
hrana. Pričom opäť každá portová hrana znamená prerušenie, lebo z vrcholov,
ktoré už majú stupeň tri nebude môcť ťah pokračovať. Ak z niektorých dvoch
budú viesť kostrové hrany, už nemôže viesť kostrová hrana medzi nimi. Pokiaľ
sú to teda portové vrcholy a nemá v nich byť prerušenie, musí viesť kostrová
hrana do druhého susedného úseku. Zvyšné dve hrany sú potom portové a tvoria
ťah. Z tohto tiež vidno, ktorý úsek vznikol skôr a môžeme ich teda rozlíšiť
podľa veku.

Poďme teraz hľadať prerušenia k vrcholom na  okraji mriežky. 
Chceme ich nájsť $2m - 2$ rôznych. Ak
v okrajovom vrchole nie je prerušenie, má, ako sme ukázali vyššie, 
dve možnosti: 
buď ide portový ťah cez neho alebo cez je icidentný s tromi kostrovými
hranami. Inak mu priradíme prerušenie ťahu v ňom. Medzi každým úsekom
vrcholov s tromi kostrovými hranami je na okraji prerušenie. Na každý úsek
ťahu na okraji pripadá jedno prerušenie.

Vrcholy na jendom okraji majú jednu súradnicu rovnakú a v druhej sa líšia.
Každému z nich vieme priradiť stĺpec alebo riadok vrcholov, ktoré sa s ním
zhodujú v tejto jednej súradnici. Ak vo vrchole nie je prerušenie, tak po
tomto stĺpci z neho odchádza kostrová hrana, ak to nie je vrchol cez ktorý na
okraj prišiel ťah z portových hrán. Takýto stĺpec musí byť niekde napojený
na kostru, pokiaľ nezačína vo vrchole s tromi kostrovými hranami. Podľa
kostry tiež vieme v akom poradí vrcholy vznikali. Každé vetvenie kostry
znamená list na kostre.

Pokiaľ má úsek viac ako dve prerušenia, zvyšné môžeme zarátať iným úsekom.
Tiež vieme, že všetky tieto portové hrany museli byť skonštruované na tri kroky.
Konštrukciu hrany na päť krokov môžeme rátať ako štyri prerušenia, lebo
medzi dvomi vrcholmi s prerušením rátame jedinú hranu.

Prvú portovú hranu do vrchola v mriežke vytvoril agent pri jeho prvej
návšteve, alebo urobil najmenej jeden krok navyše nad tri kroky na portovú
hranu.

Ak je v mriežke menej prerušení ako dve na každý vrchol kratšieho okraja,
tak z dirichletovho princípu musí existovať úsek vrcholov dlhý ako väčší
rozmer mriežky, ktorý obsahuje najviac jedno prerušenie.
Vrcholy, ktoré nevznikli tesne pred portovými hranami, ktoré z nich vedú,
znamenajú krok navyše a teda "prerušenie". Majme teda takýto úsek s najviac
jedným prerušením a zvyšné úseky s najviac dvomi prerušeniami na úsek.

Spôsob akým sú pospájané vrcholy úseku čiastočne určuje, ako budú pospájané
vrcholy v susedných úsekoch. Navyše požiadavka, aby bolo na úseku najviac
jedno prerušenie a na zvyšných najviac po dve na úsek, značne limituje
možnosti pospájania vrcholov.
Ak sa v nierktorom úseku vyskytne viac ako dve prerušenia, musia existovať
ďalšie úseky s menej ako dvomi prerušeniami. Teda môžeme predpokladať, že
hľadáme také pospájanie úseku, že si nevynucuje zvýšený počet prerušení v
iných úsekoch. Úsekov je totiž obmedzený počet a niektoré si skrátka už
nebudú mať kde vynucovať viac prerušení.

Nech teda existuje úsek s najviac jedným prerušením. Hľadáme také vedenie
hrán do neho, že z neho nevyplýva zvýšenie počtu prerušení v ostatných
úsekoch. Keďže má dva okrajové vrcholy jeden musí byť incidentný s dvomi
portovými hranami. Ak by sa na tomto úseku vyskytol vnútorný vrchol so
štyrmi kostrovými hranami, museli by kostrové hrany viesť medzi všetkými
susednými vrcholmi úseku, až po okraj minimálne na jednej jeho strane, lebo
vnútorný vrchol ako list kostra je prerušenie.

Pozrime sa teraz na úsek idúci po dlhšom okraji mriežky. Aj naňho pripadajú
najviac dve prerušenia. Ak ich obsahuje viac, tak musia za každé ďalšie
existovať ďalšie úseky s jediným prerušením, alebo za každé dve prerušenia
jeden úsek bez neho. Z konca vrchola na okraji tiež vieme určiť, z ktorého
smeru doň prišiel portový ťah, keďže bez prerušenia sa opustiť okraj nedá.

Ak je niektorý vnútorný vrchol list kostry susedí len s vrcholmi, 
ktoré majú stupeň portových hrán dva, môžeme
ho rátať za dve prerušenia. Buď je totiž najbližší koniec ťahu ďaleko alebo
je niekde v  susednom vrchole a potom je prerušenie aj v ňom.

Na dôkaz, že potrebujeme aspoň $2m - 2$ prerušení nestačí statický pohľad. Teda
cez ktoré vrcholy a ako prechádza ťah z portových hrán. Napríklad mriežka $3
\times 3$ má kostru pri ktorej tvoria portové hrany súvislý ťah. Napriek
tomu ju agent nevie skonštruovať na 12 krokov a potrebuje trinásty.

Preto bude v dôkaze potrebné využiť aj algoritmickú stránku veci a pozrieť
sa na to, ako sa správa ťah z porotvých hrán pri konštrukcii a ako jeho
úseky $"$ukladať$"$ vedľa seba tak, aby pokryli mriežku. Takiež na to, koľko
ťahov na to treba a aká je vzdialenosť koncového bodu predošlého od
začiatočného bodu nasledujúceho podľa postupnosti konštrukcie týchto ťahov.

Konštrukcia vyžaduje, aby hrany, po ktorých prejde agent pri konštrukcii
portovej hrany buď už existovali alebo boli kostrové.

Prerušenia, ktoré vieme dokázať sú v rohoch. Rohový vrchol má stupeň len
dva. Teda portový ťah v ňom môže mať len koniec alebo cez neho nemusí ísť.
Ľahko sa dá ukázať, že nie je horšia konštrukcie, kde roh skonštruujeme
spolu s jedným z jeho susedov od takej, kde skonštruujeme jeho susedné
vrcholy a agent odíde konštruovať inde. Rohy sú štyri. Jeden z nich bol
možno skonštruovaný ako prvý a jeden ako posledný. Stále však ostávajú dva z
nich.

Tiež vieme dokázať, že mriežku, ktorej jeden z rozmerov je 1, vieme
skonštruovať bez kroku nad tri kroky na hranu. Tiež ľahko vidieť, že ak je
menší z rozmerov 2, tak je nutný jeden krok $"$navyše$"$. Toto nás viedlo k
myšlienke použiť matematickú indukciu.

IP je, že na mriežku veľkosti $n \times m$, kde $m <= n$, potrebuje agent s
jedinou značkou aspoň $3*(m-1)n + m - 1$ krokov. Dokážeme, že pre mriežku 
$n
\times (m + 1)$ potrebuje aspoň $3*(m-1)*(n+1) + m$ krokov. Majme teda takúto mriežku.
Pozrime sa na jej dlhší okraj. Už vieme, že ťah portových hrán nemôže ísť po
okraji a odtiaľ zahnúť dovnútra bez krokov navyše. Tento okraj mohol agent
skonštruovať buď tak, že vytvoril portový ťah začínajúci v jednom rohu a
končiaci v druhom. Ako však už vieme, najlacnejšie je v tomto prípade
skonštruovať najprv zvyšok mriežky a z IP sme na nej urobili aspoň $m - 1$
krokov navyše. Teda celkovo to bude $m$ krokov nad tri korky na portovú
hranu..

Alebo mohol agent okraj skonštuovať
pomocou viacerých ťahov, ktoré doň prišli zvnútra mriežky. Ťah, ktorý by šiel
po susednom okraji by skončil vo vrchole, teda treba aspoň dva ťahy. Za
predpokladu, že ani jeden z dlhších okrajov nebol skonštruovaný jediným
ťahom idúcim po okraji, končia na každom z nich minimálne dva ťahy.

Potrebujeme ukázať, že pri každej konštrukcii tejto mriežky je počet krokov
medzi ťahmi dosť veľký, inak neplatí IP. Vieme, že všetky hrany rovnobežné s
ťahom idúcim po okraji mriežky sú buď staršie alebo pri ich konštrukcii
agent vykonal kroky navyše. Tiež vieme, že ak 
upravíme pohyb agenta tak, že miesto toho a by pri konštrukcii ťahu išiel na
okraj, pôjde konštruovať nasledujúci ťah v postupnosti, minie celkovo 
aspoň $m$ krokov na konštrukciu mriežky bez okraja.

Zistili sme však, že IP musíme upraviť. Vieme totiž májsť konštrukciu s len
ôsmimi prerušeniami. Agent pri nej však minie o veľa viac krokov navyše ako
pri nami dokázanej hornej hranici.

V podstate $2 m - 2$ prerušení je oproti počtu vrcholov dosť málo, teda v
drvivej väčšine vrcholov prerušenie nebude. Vnútorný vrchol bez prerušenia má dve
kostrové a dve portové hrany. Okraj bez prerušenia má tri kostrové alebo
jednu kostrovú a dve portové hrany. 

Keďže na jedno vetvenie kostry pripadá jeden list a každý vnútorný vrchol s
jedinou kostrovou hranou má prerušenie portového ťahu, teda agent vykonal
krok navyše okrem troch krokov na hranu, nemôže byť okrajových vrcholov,
ktoré majú tri kostrové hrany veľmi veľa.

Ak nerátame rohové vrcholy je na okrajoch mriežky $2m + 2n - 8$ vrcholov. 
Ak označíme vrcholy s tromi
kostrovými hranami $k$ a listy kostry $l$, musí platiť $k + l + p = 2m + 2n
- 8$ a tiež $k - l < 2m - 2 - p$, kde p je počet vrcholov na okraji, v
ktrorých je jediná z incidentných hrán portová.
Ak $n >= m$, musí byť vrcholov na okraji, cez ktoré prechádza ťah aspoň $n-3$.
Vrcholov na okraji, ktoré môžu mať všetky tri incidentné hrany kostrové zasa
môže byť najviac $2m + n - 5 - p$. Počet prerušení je tiež obmedzený: $p <=
2m - 2$. Taktiež si všimnime, že minimalizujeme počet krokov a v našej
hornej hranici sa dalo prejsť medzi koncom ťahu a začiatkom nasledujúceho na
jeden krok. Pokiaľ sa teda vykytne konštrukcia, ktorá bude chcieť byť
lepšia a vyskytne sa v nej viac ako jeden krok medzi dvomi ťahmi, bude
musieť mať o toľko menej prerušení. Teda nie je vždy výhodné znižovať počet
ťahov z portových hrán za cenu nárastu krokov medzi nimi.

Ako už bolo spomenuté, na okraji môže byť aj viac nespojených úsekov
portových hrán. Keďže však na okraji ťah končí, z každého trvá minimálne
jeden krok dostať sa do začiatku nasledújúceho ťahu.

Ak spolu susedia dva okrajové vrcholy a každý má všetky tri hrany kostrové,
tak vnútorné hrany, ktoré s nimi susedia musia byť spojené portovou hranou.
Ak je ich úsek dĺžky aspoň tri, tak vnútorné vrcholy mriežky, ktoré s nimi
susedia musia byť pospájané portovými hranami, teda vedie medzi nimi ťah
rovnobežný s okrajom. Z tých vnútorných vrcholov, v ktroých nie je
prerušenie (nie sú listom kostry), ďalej pokračuje portová hrana smerom od
okraja. Ak je ich úsek dĺžky aspoň tri tak o vnútorných vrcholoch, s ktorými
susedia, platí obdobné.

Keď sa pozrieme na úsek z okrajových vrcholov, cez ktoré prechádza portový
ťah, zistíme podobné. Sú listami kostry a do vnútorných vrcholov prichádza
kostrová hrana zo susedných vnútorných vrcholov. Títo susedia mali predtým
stupeň tri, takže majú opäť rovnaké "možnosti" ako okrajové vrcholy; tj.
môže cez ne portový ťah prechádzať, zvyšné tri hrany môžu byť kostrové
alebo v nich môže byť prerušenie portového ťahu. Za každý vnútorný vrchol,
ktorý má všetky štyri hrany kostrové sa zvýši minimálny počet listov kostry
na okraji o dva a za každé prerušenie o jedna. Toto ešte viac zvyšuje počet
vnútorných vrcholov s nimi susediacich.





\section{Viac značiek pre porty}
Mriežka aj cyklická mriežka sú grafy, ktoré sa dajú skonštruovať na $|V| - 1$
krokov, ak má agent k dispozícii dostatočný počet portov. Ako pri všetkých
grafoch aj tu je počet použitých značiek aspoň veľkosť najväčšieho rezu aký
počas konštrukcie dosiahla už skonštruovaná množina vrcholov do zvyšku
grafu.

Pri konštrukcii jedným ťahom potrebuje agent pre mriežku $m$ portov a pre
cyklickú mriežku $2m + 1$.

\begin{lem}
\label{aspoň}
Aspoň v jednej dimenzii mriežky nastane stav, keď je skonštruovaný vrchol v každej
jej súradnici a zároveň nie je taká súradnica, že všetky vrcholy s ňou sú už
skonštruované.
\end{lem}

\begin{proof}
Skôr alebo neskôr musí byť nejaký vrchol skonštruovaný v každej súradnici.
Ak sa skôr stalo, že by boli skonštruované všetky vrcholy s nejakou
súradnicou ako bol v nejakej inej skonštruovaný jediný vrchol, tak veta
platí pre druhú dimenziu.
\end{proof}

\begin{veta}
Pri konštrukcii mriežky jedným ťahom je potredných aspoň toľko značiek ako
je menší z jej rozmerov. Pri konštrukcii cyklickej mriežky je to dvojnásobok
menšieho z rozmerov. Takáto konštrukcia existuje.
\end{veta}
\begin{proof}
Na základe lemy \ref{aspoň} vieme, že pre niektorú dimenziu existuje stav,
kedy pre každú súradnicu je vytvorený nejaký vrchol a zároveň pre žiadnu nie
sú vytvorené všetky. Z toho vyplýva pre mriežku, že je otvorených aspoň
toľko portov ako je súradníc, lebo pre každú súradnicu existuje vrchol,
ktorý susedí s už vytvoreným a ešte vytvorený nie je.

Pre cyklickú mriežku olatí, že v každej súradnici existujú minimálne dva
otvorené porty. Vrcholy v jednej súradnici totiž tvoria cyklus.

Vo vrchole, kde agent práve stojí, nemusia byť otvorené porty. Keďže však za
každú súradnicu, v ktorej nie sú vytvorené všetky vrcholy a nejaké už áno,
sú otvorené porty navyše, tak agent prechádza najprv vrcholy s rovnakou 
súradnicou v dlhšej dimenzii, kým neprejde pre danú súradnicu všetky a potom
prejde do inej. Pri tomto prechode musú otvoriť ten posledný port.

Mriežku pri konštrukcii agent prechádza po súradniciach dlhšieho rozmeru,
pričom najprv vytvorí kraj v kratšom rozmere s najnižšou súradnicou dlhšieho
rozmeru a potom vždy vrhcoly o jedna väčšej súradnice. Ak $m <= n$, tak má v
momente konštrukcie druhého vrchola druhej súradnice otvorených $m$ portov
pre mriežku a $2m + 1$ pre cyklickú mriežku.
\end{proof}


